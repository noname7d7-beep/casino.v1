<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iSignal ‚Äî Aviator Analyzer</title>
  <link rel="stylesheet" href="../assets/style.css" />
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: Inter, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at center, #07121f, #02060b);
      color: #fff;
      overflow: hidden;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 18px;
      text-align: center;
      z-index: 2;
    }

    .active { display: flex; }

    .btn {
      background: linear-gradient(90deg, #ff004d, #ff7e00);
      color: #fff;
      font-weight: 700;
      padding: 10px 24px;
      border-radius: 40px;
      cursor: pointer;
      border: none;
      transition: all .2s ease;
    }
    .btn:hover { transform: scale(1.05); }

    input {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      width: 80%;
      max-width: 320px;
      font-size: 14px;
    }

    .back-btn {
      position: absolute;
      top: 16px;
      left: 16px;
      background: none;
      border: none;
      color: #0ff;
      font-size: 22px;
      cursor: pointer;
      transition: .2s;
      z-index: 3;
    }
    .back-btn:hover { color: #ff004d; }

    h2 { font-size: 26px; font-weight: 700; }

    /* –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –≤–∑—Ä—ã–≤–∞ */
    .result {
      font-size: 28px;
      font-weight: 800;
      color: #ff7e00;
      text-shadow: 0 0 8px rgba(255,126,0,0.6);
      margin-top: 20px;
    }

    /* –¢–æ–ø-–±–∞—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ */
    .topbar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 10px 20px;
      display: flex;
      justify-content: flex-end;
      background: rgba(7, 18, 31, 0.8);
      backdrop-filter: blur(10px);
      z-index: 4;
    }
    .topbar select {
      background: linear-gradient(90deg, #ff004d, #ff7e00);
      color: #fff;
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <button class="back-btn" id="backBtn">‚Üê</button>

  <!-- –¢–æ–ø-–±–∞—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ -->
  <header class="topbar">
    <div class="controls">
      <select id="langSelect" class="btn">
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
        <option value="tr">T√ºrk√ße</option>
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      </select>
    </div>
  </header>

  <!-- 1. –í–≤–æ–¥ —Å—Å—ã–ª–∫–∏ -->
  <div class="screen active" id="link-screen">
    <h2>–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –∫–∞–∑–∏–Ω–æ</h2>
    <input type="text" id="casino-link" placeholder="https://example.com/game/aviator" />
    <button class="btn" id="start-btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
    <p id="error" style="color:#f55; font-size:13px; display:none;">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞</p>
  </div>

  <!-- 2. –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—ë—Ç–∞ -->
  <div class="screen" id="flight-screen">
    <h2>üöÄ –ü–æ–ª—ë—Ç –Ω–∞—á–∞–ª—Å—è!</h2>
    <canvas id="planeCanvas"></canvas>
    <div id="multiplier" class="result">1.00x</div>
  </div>

  <!-- 3. –†–µ–∑—É–ª—å—Ç–∞—Ç -->
  <div class="screen" id="result-screen">
    <h2>üí• –°–∞–º–æ–ª—ë—Ç –≤–∑–æ—Ä–≤–∞–ª—Å—è!</h2>
    <div id="final-multiplier" class="result"></div>
    <button class="btn" id="main-btn">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</button>
  </div>

  <script>
    const linkScreen = document.getElementById("link-screen");
    const flightScreen = document.getElementById("flight-screen");
    const resultScreen = document.getElementById("result-screen");
    const error = document.getElementById("error");
    const canvas = document.getElementById("planeCanvas");
    const ctx = canvas.getContext("2d");
    const multiplierText = document.getElementById("multiplier");
    const finalMultiplier = document.getElementById("final-multiplier");

    let multiplier = 1.00;
    let flightActive = false;
    let explodeTime = 0;
    let planeX = 50;
    let planeY = 300;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∫–∏
    document.getElementById("start-btn").addEventListener("click", () => {
      const link = document.getElementById("casino-link").value.trim();
      if (!/^https?:\/\/[\w\-_.]+/.test(link)) {
        error.style.display = "block";
        return;
      }
      error.style.display = "none";
      startFlight();
    });

    function startFlight() {
      linkScreen.classList.remove("active");
      flightScreen.classList.add("active");
      multiplier = 1.00;
      planeX = 50;
      planeY = canvas.height - 200;
      flightActive = true;

      // —Å–ª—É—á–∞–π–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤–∑—Ä—ã–≤–∞ (—á–µ—Ä–µ–∑ 5‚Äì10 —Å–µ–∫—É–Ω–¥)
      explodeTime = Date.now() + (5000 + Math.random() * 5000);

      requestAnimationFrame(updateFlight);
    }

    function updateFlight() {
      if (!flightActive) return;

      const now = Date.now();

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // –õ–∏–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
      ctx.beginPath();
      ctx.moveTo(50, canvas.height - 200);
      ctx.lineTo(planeX, planeY);
      ctx.strokeStyle = "#ff004d";
      ctx.lineWidth = 3;
      ctx.stroke();

      // –°–∞–º–æ–ª—ë—Ç
      ctx.fillStyle = "#ff7e00";
      ctx.beginPath();
      ctx.moveTo(planeX, planeY);
      ctx.lineTo(planeX - 20, planeY + 5);
      ctx.lineTo(planeX - 20, planeY - 5);
      ctx.closePath();
      ctx.fill();

      planeX += 6;
      planeY -= 1.5;

      // –†–æ—Å—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
      multiplier += 0.02;
      multiplierText.textContent = multiplier.toFixed(2) + "x";

      // –≤–∑—Ä—ã–≤
      if (now >= explodeTime) {
        explode();
      } else {
        requestAnimationFrame(updateFlight);
      }
    }

    function explode() {
      flightActive = false;
      flightScreen.classList.remove("active");
      resultScreen.classList.add("active");
      finalMultiplier.textContent = multiplier.toFixed(2) + "x";
    }

    // –ù–∞–∑–∞–¥
    document.getElementById("backBtn").addEventListener("click", () => {
      window.location.href = "../index.html";
    });

    // –ì–ª–∞–≤–Ω–∞—è
    document.getElementById("main-btn").addEventListener("click", () => {
      window.location.href = "../index.html";
    });

    // Fetch translations from localStorage
    const translations = JSON.parse(localStorage.getItem("translations"));
    const savedLang = localStorage.getItem("language") || "en";

    // Apply translations
    function applyTranslations(lang) {
      document.title = translations[lang].title;
      document.querySelector("#gameDescription").textContent = translations[lang].games.aviator;
    }

    // Initialize language
    document.addEventListener("DOMContentLoaded", () => {
      applyTranslations(savedLang);
    });
  </script>
</body>
</html>
<script>
  // Load configuration from localStorage
  const config = JSON.parse(localStorage.getItem('mt_config') || '{}');
  const aviatorCfg = config.aviator || { multiplier: 1, mode: 'manual' };

  window.addEventListener('storage', (e) => {
    if (e.key === 'mt_signal') {
      try {
        const signal = JSON.parse(e.newValue);
        if (signal && signal.type === 'aviator_signal') {
          console.log('–°–∏–≥–Ω–∞–ª –æ—Ç –∞–¥–º–∏–Ω–∫–∏:', signal.multiplier);
          // —Ç—É—Ç –≤—ã–∑—ã–≤–∞–µ—à—å —Å–≤–æ—é —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–ø—É—Å–∫–∞ —Å–∞–º–æ–ª—ë—Ç–∞
        }
      } catch (err) {
        console.warn('Invalid mt_signal payload', err);
      }
    }
  });
</script>
